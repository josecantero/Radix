version: '3.8'

services:
  # Node 1: Bootstrap node with mining enabled
  node1:
    build: .
    container_name: soverx-node1
    ports:
      - "8080:8080" # P2P
      - "8090:8090" # RPC
    volumes:
      - node1-data:/soverx/data
      - ./configs/node1.json:/soverx/config.json:ro
    command: [ "soverx_node", "--config", "config.json" ]
    networks:
      - soverx-network
    environment:
      - NODE_NAME=node1

  # Node 2: Peer connecting to node1
  node2:
    build: .
    container_name: soverx-node2
    ports:
      - "8081:8080" # P2P
      - "8091:8090" # RPC
    volumes:
      - node2-data:/soverx/data
      - ./configs/node2.json:/soverx/config.json:ro
    command: [ "soverx_node", "--config", "config.json" ]
    networks:
      - soverx-network
    depends_on:
      - node1
    environment:
      - NODE_NAME=node2

  # Node 3: Another peer connecting to node1
  node3:
    build: .
    container_name: soverx-node3
    ports:
      - "8082:8080" # P2P
      - "8092:8090" # RPC
    volumes:
      - node3-data:/soverx/data
      - ./configs/node3.json:/soverx/config.json:ro
    command: [ "soverx_node", "--config", "config.json" ]
    networks:
      - soverx-network
    depends_on:
      - node1
    environment:
      - NODE_NAME=node3

networks:
  soverx-network:
    driver: bridge

volumes:
  node1-data:
  node2-data:
  node3-data:
